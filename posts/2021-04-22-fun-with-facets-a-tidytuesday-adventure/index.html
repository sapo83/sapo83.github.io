<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="Sarah Codes">
<title>
    Fun with Facets - A #TidyTuesday Adventure - Sarah Codes
</title>
<meta name="google-site-verification" content="ZeDNRFDD2w8gD6qLEq-DyiGXL3aNseNC0PU89149s40" />


<link rel="shortcut icon" href="/computer.png">








<link rel="stylesheet" href="/css/main.min.98d38cb044c5237b66dfee009fe7b294f7aef9bfa969d37d8dab599728c6da0b.css" integrity="sha256-mNOMsETFI3tm3&#43;4An&#43;eylPeu&#43;b&#43;padN9jatZlyjG2gs=" crossorigin="anonymous" media="screen">




  






<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sapo83.github.io/116"/>

<meta name="twitter:title" content="Fun with Facets - A #TidyTuesday Adventure"/>
<meta name="twitter:description" content="Facets can be a great way to visualize your data. Sometimes it helps to look at what different combinations of data look like &amp; what may be missing. I used the Superbowl commercials data set available in the #TidyTuesday github repo to introduce facets here. When visualizing multiple groups, facets can really help in making a figure with multiple panels all aligned nicely with a good-looking aesthetic.
I&rsquo;m also trying something a bit new with this post."/>

<meta property="og:title" content="Fun with Facets - A #TidyTuesday Adventure" />
<meta property="og:description" content="Facets can be a great way to visualize your data. Sometimes it helps to look at what different combinations of data look like &amp; what may be missing. I used the Superbowl commercials data set available in the #TidyTuesday github repo to introduce facets here. When visualizing multiple groups, facets can really help in making a figure with multiple panels all aligned nicely with a good-looking aesthetic.
I&rsquo;m also trying something a bit new with this post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/" />
<meta property="og:image" content="https://sapo83.github.io/116"/>
<meta property="article:published_time" content="2021-04-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-22T00:00:00+00:00" /><meta property="og:site_name" content="Sarah Codes" />


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KCFRR1DD9G', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    

    
    
    
    <title>
        
        Fun with Facets - A #TidyTuesday Adventure
        
    </title>
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>Fun with Facets - A #TidyTuesday Adventure</h1>
    </header>
    
    <main class="wrap">
        
<div class="flex-container">
    <aside role="complementary">
        Thu Apr 22, 2021 &#183; 3768 words
        <div class="tag-container">
            
            
            <span class="tag">
                <a href="/tags/tidytuesday/">
                    TidyTuesday
                </a>
            </span>
            
            
            
            <span class="tag">
                <a href="/tags/tidyverse/">
                    tidyverse
                </a>
            </span>
            
            
            
            <span class="tag">
                <a href="/tags/data.table/">
                    data.table
                </a>
            </span>
            
            
            
            <span class="tag">
                <a href="/tags/youtube/">
                    youtube
                </a>
            </span>
            
            
        </div>
    </aside>
    <hr />
    <article role="article">
        <p>Facets can be a great way to visualize your data. Sometimes it helps to look at what different combinations of data look like &amp; what may be missing. I used the <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-03-02/readme.md">Superbowl commercials</a> data set available in the #TidyTuesday github repo to introduce facets here. When visualizing multiple groups, facets can really help in making a figure with multiple panels all aligned nicely with a good-looking aesthetic.</p>
<p>I&rsquo;m also trying something a bit new with this post. I&rsquo;m posting the code in <a href="https://www.tidyverse.org/">tidyverse</a> &amp; then the same code in <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a>. When I first learned R, I used primarily the <a href="https://www.tidyverse.org/">tidyverse</a>. When I started my current position, they use <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a> more due to the size of the data sets. It&rsquo;s been fun learning how to use <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a>. I&rsquo;m challenging myself here to try &amp; write the same code in fewer lines using <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a>.</p>
<p>Ok. That&rsquo;s enough of that! Let&rsquo;s get started!</p>
<p>First, let&rsquo;s load the libraries we are going to use, read in the data &amp; take a quick peek at it!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(tidyverse)
<span style="color:#a6e22e">library</span>(data.table)
<span style="color:#a6e22e">library</span>(viridis) <span style="color:#75715e"># for color scheme in plots</span>

youtube <span style="color:#f92672">=</span> readr<span style="color:#f92672">::</span><span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-02/youtube.csv&#39;</span>)

<span style="color:#a6e22e">head</span>(youtube)
</code></pre></div><pre><code>## # A tibble: 6 x 25
##    year brand  superbowl_ads_dot_… youtube_url  funny show_product_qu… patriotic
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;               &lt;chr&gt;        &lt;lgl&gt; &lt;lgl&gt;            &lt;lgl&gt;    
## 1  2018 Toyota https://superbowl-… https://www… FALSE FALSE            FALSE    
## 2  2020 Bud L… https://superbowl-… https://www… TRUE  TRUE             FALSE    
## 3  2006 Bud L… https://superbowl-… https://www… TRUE  FALSE            FALSE    
## 4  2018 Hynud… https://superbowl-… https://www… FALSE TRUE             FALSE    
## 5  2003 Bud L… https://superbowl-… https://www… TRUE  TRUE             FALSE    
## 6  2020 Toyota https://superbowl-… https://www… TRUE  TRUE             FALSE    
## # … with 18 more variables: celebrity &lt;lgl&gt;, danger &lt;lgl&gt;, animals &lt;lgl&gt;,
## #   use_sex &lt;lgl&gt;, id &lt;chr&gt;, kind &lt;chr&gt;, etag &lt;chr&gt;, view_count &lt;dbl&gt;,
## #   like_count &lt;dbl&gt;, dislike_count &lt;dbl&gt;, favorite_count &lt;dbl&gt;,
## #   comment_count &lt;dbl&gt;, published_at &lt;dttm&gt;, title &lt;chr&gt;, description &lt;chr&gt;,
## #   thumbnail &lt;chr&gt;, channel_title &lt;chr&gt;, category_id &lt;dbl&gt;
</code></pre>
<h1 id="the-tidyversehttpswwwtidyverseorg-way" class="anchor-link"><a href="#the-tidyversehttpswwwtidyverseorg-way">The <a href="https://www.tidyverse.org/">Tidyverse</a> way<span class="pilcrow">&nbsp;¶</span></a></h1>
<p>Looks good! First thing I&rsquo;d like to do is select the columns I&rsquo;m going to use &amp; drop the rest. I prefer to filter my data in the early steps to save computational time in the long run. Here I&rsquo;m going to use <code>select()</code> and the column names to specify which columns I want to keep.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">youtube <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">select</span>(year, brand, view_count, like_count, dislike_count)
</code></pre></div><pre><code>## # A tibble: 247 x 5
##     year brand     view_count like_count dislike_count
##    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1  2018 Toyota        173929       1233            38
##  2  2020 Bud Light      47752        485            14
##  3  2006 Bud Light     142310        129            15
##  4  2018 Hynudai          198          2             0
##  5  2003 Bud Light      13741         20             3
##  6  2020 Toyota         23636        115            11
##  7  2020 Coca-Cola     304254       1470           384
##  8  2020 Kia            17892         78             6
##  9  2020 Hynudai        38385        342             7
## 10  2020 Budweiser        782          7             0
## # … with 237 more rows
</code></pre><p>Now I want to summarize my data. I&rsquo;d like to find the total number of views, the total number of likes &amp; the total number of dislikes for each year &amp; brand combination. I&rsquo;m going to use <code>group_by()</code> to get all the year/brand combos. Then use a <code>summarise()</code> command to make my new columns. For each new column, I&rsquo;ll use <code>sum()</code> to calculate the new total. I also added in <code>na.rm = TRUE</code> to drop anny NAs in the data. Let&rsquo;s see how it looks!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">youtube <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">select</span>(year, brand, view_count, like_count, dislike_count) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(year, brand) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(total_view <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(view_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            total_like <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(like_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            total_dislike <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(dislike_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
</code></pre></div><pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
</code></pre><pre><code>## # A tibble: 131 x 5
## # Groups:   year [21]
##     year brand     total_view total_like total_dislike
##    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1  2000 Bud Light       6641          7             1
##  2  2000 Budweiser    3741328      25013           527
##  3  2000 E-Trade        76218        172             6
##  4  2001 Bud Light      64573        281            10
##  5  2001 Budweiser     127230        485             7
##  6  2001 Doritos         2985         15             0
##  7  2001 E-Trade       109946        179            11
##  8  2001 NFL                0          0             0
##  9  2001 Pepsi          79531        137             7
## 10  2002 Bud Light     138770        480            20
## # … with 121 more rows
</code></pre><p>Next I&rsquo;m going to calculate the percentage of likes &amp; percentage of dislikes for each row using <code>mutate()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">youtube <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">select</span>(year, brand, view_count, like_count, dislike_count) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(year, brand) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(total_view <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(view_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            total_like <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(like_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            total_dislike <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(dislike_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(pct_like <span style="color:#f92672">=</span> (total_like<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>,
         pct_dislike <span style="color:#f92672">=</span> (total_dislike<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>)
</code></pre></div><pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
</code></pre><pre><code>## # A tibble: 131 x 7
## # Groups:   year [21]
##     year brand     total_view total_like total_dislike pct_like pct_dislike
##    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
##  1  2000 Bud Light       6641          7             1    0.105     0.0151 
##  2  2000 Budweiser    3741328      25013           527    0.669     0.0141 
##  3  2000 E-Trade        76218        172             6    0.226     0.00787
##  4  2001 Bud Light      64573        281            10    0.435     0.0155 
##  5  2001 Budweiser     127230        485             7    0.381     0.00550
##  6  2001 Doritos         2985         15             0    0.503     0      
##  7  2001 E-Trade       109946        179            11    0.163     0.0100 
##  8  2001 NFL                0          0             0  NaN       NaN      
##  9  2001 Pepsi          79531        137             7    0.172     0.00880
## 10  2002 Bud Light     138770        480            20    0.346     0.0144 
## # … with 121 more rows
</code></pre><p>Last of all, I&rsquo;d like to replace all NAs with 0 using <code>replace()</code> &amp; then use <code>select()</code> to keep only the columns I&rsquo;m going to use. Also, I&rsquo;ll use the first line (<code>plot_df = youtube %&gt;%</code>) to save the data frame. I added in a <code>head()</code> command so we can see what the final data frame looks like.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># The tidyverse way</span>
plot_df <span style="color:#f92672">=</span> youtube <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">select</span>(year, brand, view_count, like_count, dislike_count) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(year, brand) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(total_view <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(view_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            total_like <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(like_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            total_dislike <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(dislike_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(pct_like <span style="color:#f92672">=</span> (total_like<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>,
         pct_dislike <span style="color:#f92672">=</span> (total_dislike<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">replace</span>(<span style="color:#a6e22e">is.na</span>(.), <span style="color:#ae81ff">0</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">select</span>(year, brand, pct_like, pct_dislike)
</code></pre></div><pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>## # A tibble: 6 x 4
## # Groups:   year [2]
##    year brand     pct_like pct_dislike
##   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1  2000 Bud Light    0.105     0.0151 
## 2  2000 Budweiser    0.669     0.0141 
## 3  2000 E-Trade      0.226     0.00787
## 4  2001 Bud Light    0.435     0.0155 
## 5  2001 Budweiser    0.381     0.00550
## 6  2001 Doritos      0.503     0
</code></pre>
<h1 id="the-datatablehttpscranr-projectorgwebpackagesdatatablevignettesdatatable-introhtml-way" class="anchor-link"><a href="#the-datatablehttpscranr-projectorgwebpackagesdatatablevignettesdatatable-introhtml-way">The <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a> way<span class="pilcrow">&nbsp;¶</span></a></h1>
<p>Now let&rsquo;s look at the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a> way to do this. First, let&rsquo;s get the columns we want to keep. To access data in our data.table, we use the following syntax: <code>data_table[rows_to_keep, columns_to_keep]</code>. You can select rows &amp; columns by numeric index or by name. If you leave either option blank, then it still return all the rows or columns. Here we are going to use a list to select the columns we want to keep. I also used <code>as.data.table()</code> to save it as a data.table object.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot_df <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.data.table</span>(youtube[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>, <span style="color:#e6db74">&#34;view_count&#34;</span>, <span style="color:#e6db74">&#34;like_count&#34;</span>, <span style="color:#e6db74">&#34;dislike_count&#34;</span>)])

<span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>##    year     brand view_count like_count dislike_count
## 1: 2018    Toyota     173929       1233            38
## 2: 2020 Bud Light      47752        485            14
## 3: 2006 Bud Light     142310        129            15
## 4: 2018   Hynudai        198          2             0
## 5: 2003 Bud Light      13741         20             3
## 6: 2020    Toyota      23636        115            11
</code></pre><p>Next, I want to create 3 new columns: <code>total_view</code>, <code>total_like</code>, &amp; <code>total_dislike</code>. In this case, there are 3 positions inside our square brackets: [rows, columns, by].</p>
<ol>
<li>I&rsquo;m going to leave rows blank because I want to keep them all.</li>
<li>I&rsquo;m going to use lists to create all 3 columns in one step.
<ul>
<li>I&rsquo;m going to start with a list of the names I want for my new columns: <code>c(&quot;total_view&quot;, &quot;total_like&quot;, &quot;total_dislike&quot;)</code>.</li>
<li>I&rsquo;m going to use the <code>:=</code> operator. This is a function within the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">data.table</a> package that allows for fast adding, removing &amp; updating of columns.</li>
<li>Then I&rsquo;ll use another list to specify how to find the value for each of these new columns: <code>list(sum(view_count, na.rm = TRUE), sum(like_count, na.rm = TRUE), sum(dislike_count, na.rm = TRUE))</code>.</li>
<li>The first calculation (<code>sum(view_count, na.rm = TRUE)</code>) in this list will be assigned to the first name (<code>total_view</code>) in my column name list.</li>
</ul>
</li>
<li>I will use <code>by</code> to perform these calculations for each combination (grouping) of year/brand.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setDT</span>(plot_df)[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;total_view&#34;</span>, <span style="color:#e6db74">&#34;total_like&#34;</span>, <span style="color:#e6db74">&#34;total_dislike&#34;</span>) <span style="color:#f92672">:=</span> 
                 <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">sum</span>(view_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), <span style="color:#a6e22e">sum</span>(like_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                      <span style="color:#a6e22e">sum</span>(dislike_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)),
               by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>)]

<span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>##    year     brand view_count like_count dislike_count total_view total_like
## 1: 2018    Toyota     173929       1233            38     527442       2681
## 2: 2020 Bud Light      47752        485            14      47752        485
## 3: 2006 Bud Light     142310        129            15     237665        457
## 4: 2018   Hynudai        198          2             0        198          2
## 5: 2003 Bud Light      13741         20             3     533505        648
## 6: 2020    Toyota      23636        115            11      23636        115
##    total_dislike
## 1:           260
## 2:            14
## 3:            29
## 4:             0
## 5:            47
## 6:            11
</code></pre><p>I can use a similar approach to create 2 new columns for percent: <code>pct_like</code> &amp; <code>pct_dislike</code>.</p>
<ol>
<li>I&rsquo;ll leave rows blank because I don&rsquo;t want to change/filter those.</li>
<li>Use lists to create my 2 new columns.
<ul>
<li>First the list of new column names: <code>c(&quot;pct_like&quot;, &quot;pct_dislike&quot;)</code>.</li>
<li>Then our operator: <code>:=</code>.</li>
<li>Then a second list to specify how I want these values calculated: <code>list((total_like/total_view) * 100, (total_dislike/total_view) * 100)</code>.</li>
</ul>
</li>
<li>I&rsquo;m not using <code>by</code> here because I want this calculation performed on every row not on specific groupings.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot_df[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;pct_like&#34;</span>, <span style="color:#e6db74">&#34;pct_dislike&#34;</span>) <span style="color:#f92672">:=</span> <span style="color:#a6e22e">list</span>((total_like<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, 
                                               (total_dislike<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>)]

<span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>##    year     brand view_count like_count dislike_count total_view total_like
## 1: 2018    Toyota     173929       1233            38     527442       2681
## 2: 2020 Bud Light      47752        485            14      47752        485
## 3: 2006 Bud Light     142310        129            15     237665        457
## 4: 2018   Hynudai        198          2             0        198          2
## 5: 2003 Bud Light      13741         20             3     533505        648
## 6: 2020    Toyota      23636        115            11      23636        115
##    total_dislike  pct_like pct_dislike
## 1:           260 0.5083023 0.049294520
## 2:            14 1.0156643 0.029318144
## 3:            29 0.1922875 0.012202049
## 4:             0 1.0101010 0.000000000
## 5:            47 0.1214609 0.008809664
## 6:            11 0.4865459 0.046539178
</code></pre><p>Last of all, I will replace any NAs with 0 &amp; select only the columns I&rsquo;ll be using.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot_df<span style="color:#a6e22e">[is.na</span>(plot_df)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
plot_df <span style="color:#f92672">=</span> plot_df[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>, <span style="color:#e6db74">&#34;pct_like&#34;</span>, <span style="color:#e6db74">&#34;pct_dislike&#34;</span>)]

<span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>##    year     brand  pct_like pct_dislike
## 1: 2018    Toyota 0.5083023 0.049294520
## 2: 2020 Bud Light 1.0156643 0.029318144
## 3: 2006 Bud Light 0.1922875 0.012202049
## 4: 2018   Hynudai 1.0101010 0.000000000
## 5: 2003 Bud Light 0.1214609 0.008809664
## 6: 2020    Toyota 0.4865459 0.046539178
</code></pre><p>For reference, here is the entire <a href="(https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html)">data.table</a> process in one code chunk.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># The data table way</span>
plot_df <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.data.table</span>(youtube[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>, <span style="color:#e6db74">&#34;view_count&#34;</span>, <span style="color:#e6db74">&#34;like_count&#34;</span>, <span style="color:#e6db74">&#34;dislike_count&#34;</span>)])
<span style="color:#a6e22e">setDT</span>(plot_df)[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;total_view&#34;</span>, <span style="color:#e6db74">&#34;total_like&#34;</span>, <span style="color:#e6db74">&#34;total_dislike&#34;</span>) <span style="color:#f92672">:=</span> 
                 <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">sum</span>(view_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), <span style="color:#a6e22e">sum</span>(like_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                      <span style="color:#a6e22e">sum</span>(dislike_count, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)),
               by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>)]
plot_df[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;pct_like&#34;</span>, <span style="color:#e6db74">&#34;pct_dislike&#34;</span>) <span style="color:#f92672">:=</span> <span style="color:#a6e22e">list</span>((total_like<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, 
                                               (total_dislike<span style="color:#f92672">/</span>total_view) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>)]
plot_df<span style="color:#a6e22e">[is.na</span>(plot_df)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
plot_df <span style="color:#f92672">=</span> plot_df[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>, <span style="color:#e6db74">&#34;pct_like&#34;</span>, <span style="color:#e6db74">&#34;pct_dislike&#34;</span>)]

<span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>##    year     brand  pct_like pct_dislike
## 1: 2018    Toyota 0.5083023 0.049294520
## 2: 2020 Bud Light 1.0156643 0.029318144
## 3: 2006 Bud Light 0.1922875 0.012202049
## 4: 2018   Hynudai 1.0101010 0.000000000
## 5: 2003 Bud Light 0.1214609 0.008809664
## 6: 2020    Toyota 0.4865459 0.046539178
</code></pre>
<h1 id="lets-get-to-plottin" class="anchor-link"><a href="#lets-get-to-plottin">Let&rsquo;s get to plottin!<span class="pilcrow">&nbsp;¶</span></a></h1>
<p>First, we need to reshape our data frame from wide to long. Here I&rsquo;ll use <code>melt()</code> from the <code>reshape2</code> package to do that.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot_df <span style="color:#f92672">=</span> reshape2<span style="color:#f92672">::</span><span style="color:#a6e22e">melt</span>(plot_df, id.vars <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;brand&#34;</span>))

<span style="color:#75715e"># Hyundai is misspelled. Let&#39;s fix that.</span>
plot_df<span style="color:#f92672">$</span>brand <span style="color:#f92672">=</span> <span style="color:#a6e22e">if_else</span>(plot_df<span style="color:#f92672">$</span>brand <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Hynudai&#34;</span>, <span style="color:#e6db74">&#34;Hyundai&#34;</span>, plot_df<span style="color:#f92672">$</span>brand)

<span style="color:#a6e22e">head</span>(plot_df)
</code></pre></div><pre><code>##   year     brand variable     value
## 1 2018    Toyota pct_like 0.5083023
## 2 2020 Bud Light pct_like 1.0156643
## 3 2006 Bud Light pct_like 0.1922875
## 4 2018   Hyundai pct_like 1.0101010
## 5 2003 Bud Light pct_like 0.1214609
## 6 2020    Toyota pct_like 0.4865459
</code></pre><p>Let&rsquo;s talk a little bit about facets. The idea of facets is to break down a more complex data set into smaller groups by one variable. For example, we have all this data for multiple years. Rather than try to shove all the years in one plot &amp; try to make sense of it, we can use <code>facet_wrap()</code> to make one plot for each year. Thus breaking up our data &amp; making it easier to see &amp; make sense of.</p>
<p>When you&rsquo;re looking at your data to get an idea of what you have, facets can be a great way to see what combination of variables you have &amp; which ones are missing. Maybe you are missing data for a certain brand in a certain year. Facets would be a very easy way to see that quickly.</p>
<p>Facets are also a really great way to align multiple panels together into a single figure. It takes a lot of the stress out of making sure everything is aligned &amp; in the right color scheme, etc. You can change the aesthetics to make a really great looking figure!</p>
<p>I&rsquo;m going to show a couple different arrangements of facets. While not all of them will look fantastic, it will give you a bit of an idea of the diversity of things you can visualize with facets.</p>
<p>First, let&rsquo;s facet by brand. We call <code>ggplot()</code> the way we normally would, specifying our x variable, y variable &amp; fill. Then we use <code>geom_bar()</code> to specify the type of plot we want. Then we add <code>facet_wrap(~ brand)</code> to facet these plots by brand.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> variable)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Looks neat, right? Next let&rsquo;s facet by year! We can use the same code, only this time we&rsquo;ll put <code>year</code> in the <code>facet_wrap()</code> call.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> variable)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> year)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Another good one! We can very quickly see that in 2010 there were way more likes than in the other years.</p>
<p>Now let&rsquo;s do one better. We can use <code>facet_grid()</code> to show all the combinations of year &amp; brand.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand &amp; year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> variable)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_grid</span>(year <span style="color:#f92672">~</span> brand)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>The labels are a bit hard to read but you get the idea! We have all the brands across the top (columns) &amp; all the years along right (rows).</p>
<p>Now let&rsquo;s take a step back &amp; look at some of the things we can do with these faceted plots. I&rsquo;m going to work with the plot faceted by brand. We can control the arrangement of the plots by adding either <code>ncol</code> or <code>nrow</code> to the <code>facet_wrap()</code> call.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> variable)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Sometimes it&rsquo;s helpful to let each plot have it&rsquo;s own x or y axis. We can do that by adding <code>scales = &quot;free&quot;</code> to the <code>facet_wrap()</code> call. If you only want to &ldquo;free&rdquo; on one axis, you can use <code>free_x</code> or <code>free_y</code>. Here we&rsquo;re going to &ldquo;free&rdquo; the y axis.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> variable)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;free_y&#34;</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The last thing I want to touch on is how to change the strip position. The strip is the label naming each plot. In the plot above, the strip is the area with the brand name in it. You can choose the position using <code>strip.position()</code> in the <code>facet_wrap()</code> call. The options here are top, bottom, left, right. Here I&rsquo;m going to move the strips to the bottom.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> variable)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;free_y&#34;</span>, strip.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>For the final plot here, I&rsquo;m going to mix it up a bit. I&rsquo;m going to stick with faceting by brand, but I&rsquo;m going to color the bars by year instead of by variable. I&rsquo;m also going to remove the &ldquo;free&rdquo; y axis command from <code>facet_wrap()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> year)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, strip.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Right now, the <code>year</code> variable is being treated as a numeric variable so it&rsquo;s on a continuous scale. I would like to put it on a discrete scale. To do this, I&rsquo;m going to set the fill equal to <code>as.factor(year)</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, strip.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>That looks better! I&rsquo;m going to move the strip back up to the top &amp; start cleaning up the axes. First off, I&rsquo;d like to rename the y axis. I&rsquo;m going to do this using the <code>labs()</code>. Next, I&rsquo;m going to remove the x axis title by adding <code>axis.title.x = element_blank()</code> to my <code>theme()</code> call. I&rsquo;m going to use the <code>labels</code> argument of <code>scale_x_discrete()</code> to change the name of the categories on the x axis. I&rsquo;ll pass a list to the <code>labels</code> argument.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percent of Total Views&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Likes&#34;</span>, <span style="color:#e6db74">&#34;Dislikes&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
        axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>())
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Looking good! Next, I&rsquo;d like to clean up the legend. I want to change the title &amp; the layout. The way it is right now, it&rsquo;s taking up way too much space! I&rsquo;ll add <code>fill = &quot;Year&quot;</code> to the <code>labs()</code> call to change the title of the legend. Then I&rsquo;ll add <code>guides(fill = guide_legend(nrow = 3))</code> to change the number of rows in the legend.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percent of Total Views&#34;</span>,
       fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Year&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Likes&#34;</span>, <span style="color:#e6db74">&#34;Dislikes&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
        axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>())
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>That&rsquo;s better. Now let&rsquo;s change up the strips. I&rsquo;m going to use <code>sstrip.background = element_blank()</code> in the <code>theme</code> call to remove the grey background from the strip. Then I&rsquo;m going to bump up the font size by using <code>strip.text = element_text(size = 14)</code> in the <code>theme()</code> call.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percent of Total Views&#34;</span>,
       fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Year&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Likes&#34;</span>, <span style="color:#e6db74">&#34;Dislikes&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
        axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>))
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Even better! Next I want to remove the panel in the actual plot &amp; change up the grid lines a bit. By using <code>panel.background = element_blank()</code> in the <code>theme()</code> call, I can remove the grey panel background. I will change the y axis grid lines to dsahed grey lines using <code>panel.grid.major.y = element_line(linetype = &quot;dashed&quot;, color = &quot;grey&quot;)</code> in the <code>theme()</code> call. Last of all, I&rsquo;ll remove the tick marks from both axes using <code>axis.ticks = element_blank()</code> in the <code>theme()</code> call.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percent of Total Views&#34;</span>,
       fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Year&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Likes&#34;</span>, <span style="color:#e6db74">&#34;Dislikes&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
        axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>),
        panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_line</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey&#34;</span>),
        axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>())
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>I think I want to add a border to make the panels a bit more clear. I can do this by adding <code>panel.border = element_rect(linetype = &quot;solid&quot;, fill = NA)</code> to the <code>theme()</code> call. Last of all, I want to change the colors of each year. I&rsquo;m going to use on of the new <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis</a> palettes. I&rsquo;ll add the color palette by adding <code>scale_fill_viridis_d(option = &quot;turbo&quot;)</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percent of Total Views&#34;</span>,
       fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Year&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Likes&#34;</span>, <span style="color:#e6db74">&#34;Dislikes&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
        axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>),
        panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_line</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey&#34;</span>),
        axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        panel.border <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_rect</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;solid&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_fill_viridis_d</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;turbo&#34;</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Last of all, let&rsquo;s add in a title here. I&rsquo;ll add the actual title in <code>labs()</code>. The default in <a href="https://ggplot2.tidyverse.org/">ggplot2</a> is to left align the title. I prefer mine centered so I&rsquo;m going to use <code>plot.title = element_text(hjust = 0.5)</code> in the <code>theme()</code> call. I also added <code>size = 17</code> to change the font size as well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># facet by brand, fill by year</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> plot_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> variable, y <span style="color:#f92672">=</span> value, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.factor</span>(year))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_bar</span>(stat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;identity&#34;</span>, position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stack&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> brand, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percent of Total Views&#34;</span>,
       fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Year&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Youtube Likes &amp; Dislikes of Superbowl Commercials&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_discrete</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Likes&#34;</span>, <span style="color:#e6db74">&#34;Dislikes&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
        axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>),
        panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_line</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey&#34;</span>),
        axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
        panel.border <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_rect</span>(linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;solid&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>),
        plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(hjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_fill_viridis_d</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;turbo&#34;</span>)
</code></pre></div><p><img src="https://sapo83.github.io/posts/2021-04-22-fun-with-facets-a-tidytuesday-adventure/index_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Whew! That was a lot but it looks gooooood! I hope you learned a bit about how to use facets to better visualize your data. Feel free to reach out with any questions/comments/concerns via <a href="https://twitter.com/sapo83">Twitter</a> or using one of the other methods on my <a href="https://sapo83.github.io/contact/">contact</a> page. Thanks for reading!</p>

    </article>
</div>


        
<nav role="navigation" class="flex-container bottom-menu">
    
<hr />
<p>


    
        <a href="/posts">back</a>
        
            &#183;
        
    

    
        
            <a href="/posts">posts</a>
        
    
    
        
            &#183; 
            <a href="/pubs">publications</a>
        
            &#183; 
            <a href="/about">about</a>
        
            &#183; 
            <a href="/contact">contact</a>
        
    
    
    
        &#183; 
        <a href="/">
            main
        </a>
    

</p>
</nav>

    </main>
    
    <footer class="flex-container footer">Copyright © 2021. Sarah Entwistle. All rights reserved.
</footer>
    
    
</body>

</html>